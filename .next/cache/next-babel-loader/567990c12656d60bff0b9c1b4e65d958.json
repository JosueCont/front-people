{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Layout, Breadcrumb, Table, Row, Col, Input, Select, Switch, Button, Modal, Form } from \"antd\";\nimport Axios from \"axios\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { DeleteOutlined, EditOutlined, InfoCircleOutlined, SearchOutlined, PlusOutlined } from \"@ant-design/icons\";\nimport HeaderCustom from \"../../components/Header\";\nimport { API_URL } from \"../../config/config\";\nimport Router from \"next/router\";\nconst {\n  TextArea\n} = Input;\nconst {\n  Content\n} = Layout;\nconst {\n  Option\n} = Select;\n\nconst businessForm = () => {\n  const {\n    0: business,\n    1: setBusiness\n  } = useState([]);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: isModalVisible,\n    1: setIsModalVisible\n  } = useState(false);\n  const {\n    0: isEdit,\n    1: setIsEdit\n  } = useState(false);\n  const [formBusiness] = Form.useForm();\n  const {\n    0: isModalDeleteVisible,\n    1: setIsModalDeleteVisible\n  } = useState(false);\n  const {\n    0: isDeleted,\n    1: setIsDeleted\n  } = useState(false);\n  const {\n    0: businessName,\n    1: setBusinessName\n  } = useState(\"\");\n\n  const onFinish = values => {\n    if (isDeleted) {\n      deleteBusiness(values.id);\n    } else {\n      if (!isEdit) {\n        addBusiness(values.name, values.description, values.FNode);\n      } else {\n        updateBusiness(values.id, values.name, values.description, values.FNode);\n      }\n    }\n  };\n\n  const deleteBusiness = async (id, name, description) => {\n    Axios.delete(API_URL + \"/business/node/\" + id + \"/\").then(function (response) {\n      if (response.status === 200) {\n        Router.push(\"/business\");\n      }\n\n      getBusiness();\n      setIsModalVisible(false);\n      setIsModalDeleteVisible(false);\n      setLoading(false);\n    }).catch(function (error) {\n      setLoading(false);\n      console.log(error);\n    });\n  };\n\n  const updateBusiness = async (id, name, description, fNode) => {\n    const data = {\n      name: name,\n      description: description,\n      parent: fNode ? fNode : null\n    };\n    Axios.put(API_URL + \"/business/node/\" + id + \"/\", data).then(function (response) {\n      if (response.status === 200) {\n        Router.push(\"/business\");\n      }\n\n      getBusiness();\n      setIsModalVisible(false);\n      setLoading(false);\n    }).catch(function (error) {\n      setLoading(false);\n      console.log(error);\n    });\n  };\n\n  const addBusiness = async (name, description, fNode) => {\n    const data = {\n      name: name,\n      description: description,\n      parent: fNode ? fNode : null\n    };\n    Axios.post(API_URL + \"/business/node/\", data).then(function (response) {\n      if (response.status === 200) {\n        Router.push(\"/business\");\n      }\n\n      getBusiness();\n      setIsModalVisible(false);\n      setLoading(false);\n    }).catch(function (error) {\n      setLoading(false);\n      console.log(error);\n    });\n  };\n\n  const showModal = (type, item) => {\n    if (type === \"add\") {\n      setIsDeleted(false);\n      setIsEdit(false);\n      formBusiness.resetFields();\n      setIsModalVisible(true);\n    } else if (type === \"edit\") {\n      setIsDeleted(false);\n      setIsEdit(true);\n      formBusiness.setFieldsValue({\n        name: item.name,\n        description: item.description,\n        FNode: item.parent ? item.parent.id : null,\n        id: item.id\n      });\n      setIsModalVisible(true);\n    } else {\n      setIsDeleted(true);\n      setIsModalDeleteVisible(true);\n      setBusinessName(item.name);\n      formBusiness.setFieldsValue({\n        id: item.id\n      });\n    }\n  };\n\n  const handleOk = () => {\n    setIsModalVisible(false);\n  };\n\n  const handleCancel = () => {\n    setIsModalVisible(false);\n    setIsModalDeleteVisible(false);\n  };\n\n  const getBusiness = () => {\n    setLoading(true);\n    Axios.get(API_URL + \"/business/node/\").then(response => {\n      setBusiness(response.data.results);\n      setLoading(false);\n    }).catch(e => {\n      console.log(e);\n      setLoading(false);\n    });\n  };\n\n  useEffect(() => {\n    getBusiness();\n  }, []);\n  const columns = [{\n    title: \"Nombre\",\n    dataIndex: \"name\",\n    key: \"name\"\n  }, {\n    title: \"Código\",\n    dataIndex: \"code\",\n    key: \"code\"\n  }, {\n    title: \"Nodo padre\",\n    dataIndex: \"parent\",\n    key: \"parent\",\n    render: parent => {\n      return parent ? parent.name : null;\n    }\n  }, {\n    title: \"Activo\",\n    dataIndex: \"active\",\n    key: \"active\",\n    render: text => {\n      return text === true ? /*#__PURE__*/_jsx(\"p\", {\n        children: \"S\\xED\"\n      }) : /*#__PURE__*/_jsx(\"p\", {\n        children: \"No\"\n      });\n    }\n  }, {\n    title: \"Opciones\",\n    render: item => {\n      return /*#__PURE__*/_jsx(\"div\", {\n        children: /*#__PURE__*/_jsxs(Row, {\n          gutter: 16,\n          children: [/*#__PURE__*/_jsx(Col, {\n            className: \"gutter-row\",\n            span: 6,\n            children: /*#__PURE__*/_jsx(EditOutlined, {\n              onClick: () => showModal(\"edit\", item)\n            })\n          }), /*#__PURE__*/_jsx(Col, {\n            className: \"gutter-row\",\n            span: 6,\n            children: /*#__PURE__*/_jsx(DeleteOutlined, {\n              onClick: () => showModal(\"delete\", item)\n            })\n          })]\n        })\n      });\n    }\n  }];\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: /*#__PURE__*/_jsxs(Layout, {\n      children: [/*#__PURE__*/_jsx(HeaderCustom, {}), /*#__PURE__*/_jsxs(Content, {\n        className: \"site-layout\",\n        style: {\n          padding: \"0 50px\",\n          marginTop: 64\n        },\n        children: [/*#__PURE__*/_jsxs(Breadcrumb, {\n          style: {\n            margin: \"16px 0\"\n          },\n          children: [/*#__PURE__*/_jsx(Breadcrumb.Item, {\n            children: \"Home\"\n          }), /*#__PURE__*/_jsx(Breadcrumb.Item, {\n            children: \"Empresa\"\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            padding: \"1%\",\n            float: \"right\"\n          },\n          children: /*#__PURE__*/_jsxs(Button, {\n            style: {\n              background: \"#fa8c16\",\n              fontWeight: \"bold\",\n              color: \"white\"\n            },\n            onClick: () => showModal(\"add\"),\n            children: [/*#__PURE__*/_jsx(PlusOutlined, {}), \"Agregar empresa\"]\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"site-layout-background\",\n          style: {\n            padding: 24,\n            minHeight: 380,\n            height: \"100%\"\n          },\n          children: /*#__PURE__*/_jsx(Table, {\n            size: \"small\",\n            columns: columns,\n            dataSource: business,\n            loading: loading\n          })\n        }), /*#__PURE__*/_jsx(Modal, {\n          title: isEdit ? \"Actualizar empresa\" : \"Agregar empresa\",\n          visible: isModalVisible,\n          onCancel: () => handleOk(),\n          footer: [/*#__PURE__*/_jsx(Button, {\n            onClick: handleCancel,\n            children: \"Regresar\"\n          }, \"back\"), /*#__PURE__*/_jsx(Button, {\n            form: \"addBusinessForm\",\n            type: \"primary\",\n            htmlType: \"submit\",\n            children: isEdit ? \"Actualizar\" : \"Agregar\"\n          }, \"submit\")],\n          children: /*#__PURE__*/_jsxs(Form, {\n            id: \"addBusinessForm\",\n            name: \"normal_login\",\n            onFinish: onFinish,\n            layout: \"vertical\",\n            form: formBusiness,\n            children: [/*#__PURE__*/_jsx(Form.Item, {\n              name: \"id\",\n              label: \"id\",\n              style: {\n                display: \"none\"\n              },\n              children: /*#__PURE__*/_jsx(Input, {\n                type: \"text\"\n              })\n            }), /*#__PURE__*/_jsx(Form.Item, {\n              name: \"name\",\n              label: \"Nombre\",\n              rules: [{\n                required: true,\n                message: \"Ingresa un nombre\"\n              }],\n              children: /*#__PURE__*/_jsx(Input, {\n                placeholder: \"Nombre de la empresa\"\n              })\n            }), /*#__PURE__*/_jsx(Form.Item, {\n              name: \"description\",\n              label: \"Descripci\\xF3n\",\n              rules: [{\n                required: true,\n                message: \"Ingresa una descripción\"\n              }],\n              children: /*#__PURE__*/_jsx(TextArea, {\n                rows: 4\n              })\n            }), /*#__PURE__*/_jsx(Form.Item, {\n              name: \"FNode\",\n              label: \"Nodo padre\",\n              children: /*#__PURE__*/_jsx(Select, {\n                showSearch: true,\n                placeholder: \"Select a person\",\n                optionFilterProp: \"children\",\n                name: \"fNode\",\n                filterOption: (input, option) => option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0,\n                children: business.map(bus => /*#__PURE__*/_jsx(Option, {\n                  value: bus.id,\n                  children: bus.name\n                }))\n              })\n            })]\n          })\n        }), /*#__PURE__*/_jsx(Modal, {\n          title: \"Eliminar empresa \" + businessName,\n          visible: isModalDeleteVisible,\n          footer: [/*#__PURE__*/_jsx(Button, {\n            onClick: handleCancel,\n            children: \"Regresar\"\n          }, \"back\"), /*#__PURE__*/_jsx(Button, {\n            form: \"deleteBusinessForm\",\n            type: \"primary\",\n            htmlType: \"submit\",\n            children: \"Eliminar\"\n          }, \"submit\")],\n          children: /*#__PURE__*/_jsxs(Form, {\n            id: \"deleteBusinessForm\",\n            name: \"normal_login\",\n            onFinish: onFinish,\n            layout: \"vertical\",\n            form: formBusiness,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"float-label\",\n              children: /*#__PURE__*/_jsx(\"label\", {\n                children: \"\\xBFEst\\xE1 seguro de eliminar esta empresa?\"\n              })\n            }), /*#__PURE__*/_jsx(Form.Item, {\n              name: \"id\",\n              label: \"id\",\n              style: {\n                display: \"none\"\n              },\n              children: /*#__PURE__*/_jsx(Input, {\n                type: \"text\"\n              })\n            })]\n          })\n        })]\n      })]\n    })\n  });\n};\n\nexport default businessForm;","map":null,"metadata":{},"sourceType":"module"}