{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { Layout, Breadcrumb, Table, Row, Col, Input, Select, Switch, Button, Form, Upload, message } from \"antd\";\nimport Axios from \"axios\";\nimport { API_URL } from \"../../config/config\";\nimport { useCallback, useEffect, useState, useRef } from \"react\";\nimport { DeleteOutlined, EditOutlined, InfoCircleOutlined, SearchOutlined, PlusOutlined, DownloadOutlined, UploadOutlined } from \"@ant-design/icons\";\nimport HeaderCustom from \"../../components/Header\";\nimport _ from \"lodash\";\nimport FormPerson from \"../../components/person/FormPerson\";\nvar Content = Layout.Content;\nimport Link from \"next/link\";\n\nvar homeScreen = function homeScreen() {\n  var _useState = useState([]),\n      person = _useState[0],\n      setPerson = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(true),\n      status = _useState3[0],\n      setStatus = _useState3[1];\n\n  var _useState4 = useState(false),\n      modal = _useState4[0],\n      setModal = _useState4[1];\n\n  var _Form$useForm = Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      formFilter = _Form$useForm2[0];\n\n  var inputFileRef = useRef(null);\n  var filters = {};\n\n  var getPerson = function getPerson(text) {\n    setLoading(true);\n\n    if (text == undefined) {\n      Axios.get(API_URL + \"/person/person/\").then(function (response) {\n        response.data.results.map(function (item) {\n          item[\"key\"] = item.id;\n          item[\"fullname\"] = item.first_name + \" \" + item.flast_name + \" \" + item.mlast_name;\n          item.timestamp = item.timestamp.substring(0, 10);\n        });\n        setPerson(response.data.results);\n        setLoading(false);\n      })[\"catch\"](function (e) {\n        console.log(e);\n      });\n    } else {\n      Axios.post(API_URL + \"/person/person/get_list_persons/ \", filters).then(function (response) {\n        response.data.map(function (item) {\n          item[\"key\"] = item.id;\n          item[\"fullname\"] = item.first_name + \" \" + item.flast_name + \" \" + item.mlast_name;\n          item.timestamp = item.timestamp.substring(0, 10);\n        });\n        setPerson(response.data);\n        setLoading(false);\n      })[\"catch\"](function (e) {\n        setPerson([]);\n        setLoading(false);\n        console.log(e);\n      });\n    }\n  };\n\n  var statusPeron = function statusPeron() {\n    setStatus(status ? false : true);\n  };\n\n  var filter = function filter(value) {\n    if (value.name !== undefined && value.name !== \"\") {\n      filters.first_name = value.name;\n    }\n\n    if (value.gender !== undefined) {\n      filters.gender = value.gender;\n    }\n\n    if (status !== undefined) {\n      filters.is_active = status == false ? 0 : 1;\n    }\n\n    getPerson(\"filter\");\n  };\n\n  useEffect(function () {\n    getPerson();\n  }, []);\n  var columns = [{\n    title: \"Nombre\",\n    dataIndex: \"fullname\",\n    key: \"fullname\"\n  }, {\n    title: \"Fecha de registro\",\n    dataIndex: \"timestamp\",\n    key: \"timestamp\"\n  }, {\n    title: \"RFC\",\n    dataIndex: \"rfc\",\n    key: \"rfc\"\n  }, {\n    title: \"IMSS\",\n    dataIndex: \"imss\",\n    key: \"imss\"\n  }, {\n    title: \"Opciones\",\n    render: function render(item) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        children: /*#__PURE__*/_jsxs(Row, {\n          gutter: 16,\n          children: [/*#__PURE__*/_jsx(Col, {\n            className: \"gutter-row\",\n            span: 6,\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/home/\".concat(item.id),\n              children: /*#__PURE__*/_jsx(EditOutlined, {})\n            })\n          }), /*#__PURE__*/_jsx(Col, {\n            className: \"gutter-row\",\n            span: 6,\n            children: /*#__PURE__*/_jsx(DeleteOutlined, {})\n          }), /*#__PURE__*/_jsx(Col, {\n            className: \"gutter-row\",\n            span: 6,\n            children: /*#__PURE__*/_jsx(InfoCircleOutlined, {})\n          })]\n        })\n      });\n    }\n  }];\n  var genders = [{\n    label: \"Maculino\",\n    value: 1\n  }, {\n    label: \"Femenino\",\n    value: 2\n  }, {\n    label: \"Otro\",\n    value: 3\n  }];\n\n  var getModal = function getModal(value) {\n    setModal(value);\n    setLoading(true);\n    Axios.get(API_URL + \"/person/person/\").then(function (response) {\n      response.data.results.map(function (item) {\n        item[\"key\"] = item.id;\n        item[\"fullname\"] = item.first_name + \" \" + item.flast_name + \" \" + item.mlast_name;\n        item.timestamp = item.timestamp.substring(0, 10);\n      });\n      setPerson(response.data.results);\n      setLoading(false);\n    })[\"catch\"](function (e) {\n      console.log(e);\n    });\n  };\n\n  var downloadPersons = function downloadPersons() {\n    setLoading(true);\n    Axios.get(API_URL + \"/person/import-export-person/csv\").then(function (response) {\n      var type = response.headers[\"content-type\"];\n      var blob = new Blob([response.data], {\n        type: type,\n        encoding: \"UTF-8\"\n      });\n      var link = document.createElement(\"a\");\n      link.href = window.URL.createObjectURL(blob);\n      link.download = \"Personas.csv\";\n      link.click();\n      setLoading(false);\n    })[\"catch\"](function (e) {\n      setLoading(false);\n      console.log(e);\n    });\n  };\n\n  var importFile = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var extension, formData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              extension = getFileExtension(e.target.files[0].name);\n\n              if (extension == \"xlsx\") {\n                formData = new FormData();\n                formData.append(\"File\", e.target.files[0]);\n                console.log(formData);\n                setLoading(true);\n                Axios.post(API_URL + \"/person/import-export-person\", formData).then(function (response) {\n                  setLoading(false);\n                  message.success(\"Excel importado correctamente.\");\n                  getPerson();\n                })[\"catch\"](function (e) {\n                  setLoading(false);\n                  message.error(\"Error al importar.\");\n                  console.log(e);\n                });\n              } else {\n                message.error(\"Formato incorrecto, suba un archivo .xlsx\");\n              }\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function importFile(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getFileExtension = function getFileExtension(filename) {\n    return /[.]/.exec(filename) ? /[^.]+$/.exec(filename)[0] : undefined;\n  };\n\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: /*#__PURE__*/_jsxs(Layout, {\n      children: [/*#__PURE__*/_jsx(HeaderCustom, {}), /*#__PURE__*/_jsxs(Content, {\n        className: \"site-layout\",\n        style: {\n          padding: \"0 50px\",\n          marginTop: 64\n        },\n        children: [/*#__PURE__*/_jsxs(Breadcrumb, {\n          style: {\n            margin: \"16px 0\"\n          },\n          children: [/*#__PURE__*/_jsx(Breadcrumb.Item, {\n            children: \"Home\"\n          }), /*#__PURE__*/_jsx(Breadcrumb.Item, {\n            children: \"Person\"\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"site-layout-background\",\n          style: {\n            padding: 24,\n            minHeight: 380,\n            height: \"100%\"\n          },\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            style: {\n              padding: 24\n            },\n            children: [/*#__PURE__*/_jsxs(Form, {\n              onFinish: filter,\n              layout: \"vertical\",\n              form: formFilter,\n              children: [/*#__PURE__*/_jsxs(Row, {\n                children: [/*#__PURE__*/_jsx(Col, {\n                  span: 18,\n                  children: /*#__PURE__*/_jsx(Form.Item, {\n                    name: \"name\",\n                    children: /*#__PURE__*/_jsx(Input, {\n                      placeholder: \"Nombre...\"\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(Col, {\n                  span: 5,\n                  children: /*#__PURE__*/_jsx(Form.Item, {\n                    name: \"gender\",\n                    children: /*#__PURE__*/_jsx(Select, {\n                      style: {\n                        marginLeft: \"10%\",\n                        width: \"100%\"\n                      },\n                      options: genders,\n                      placeholder: \"G\\xE9nero\"\n                    })\n                  })\n                })]\n              }), /*#__PURE__*/_jsxs(Row, {\n                style: {\n                  marginTop: \"2%\"\n                },\n                children: [/*#__PURE__*/_jsx(Col, {\n                  span: 4,\n                  children: /*#__PURE__*/_jsxs(Form.Item, {\n                    name: \"is_active\",\n                    children: [/*#__PURE__*/_jsx(\"label\", {\n                      children: /*#__PURE__*/_jsx(\"span\", {\n                        style: {\n                          fontWeight: \"bold\"\n                        },\n                        children: \"Activos:\"\n                      })\n                    }), /*#__PURE__*/_jsx(Switch, {\n                      style: {\n                        marginLeft: \"10%\"\n                      },\n                      defaultChecked: true,\n                      onChange: statusPeron\n                    })]\n                  })\n                }), /*#__PURE__*/_jsx(Col, {\n                  span: 8,\n                  style: {\n                    \"float\": \"right\"\n                  },\n                  children: /*#__PURE__*/_jsx(Form.Item, {\n                    children: /*#__PURE__*/_jsx(Button, {\n                      type: \"primary\",\n                      htmlType: \"submit\",\n                      children: \"Buscar\"\n                    })\n                  })\n                })]\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              style: {\n                \"float\": \"right\"\n              },\n              children: [/*#__PURE__*/_jsx(Button, {\n                type: \"primary\",\n                icon: /*#__PURE__*/_jsx(DownloadOutlined, {}),\n                size: {\n                  size: \"large\"\n                },\n                onClick: function onClick() {\n                  return downloadPersons();\n                },\n                children: \"Descargar resultados\"\n              }), /*#__PURE__*/_jsx(Button, {\n                icon: /*#__PURE__*/_jsx(UploadOutlined, {}),\n                onClick: function onClick() {\n                  inputFileRef.current.click();\n                },\n                children: \"Importar personas\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                ref: inputFileRef,\n                type: \"file\",\n                style: {\n                  display: \"none\"\n                },\n                onChange: function onChange(e) {\n                  return importFile(e);\n                }\n              })]\n            })]\n          }), /*#__PURE__*/_jsx(Table, {\n            size: \"small\",\n            columns: columns,\n            dataSource: person,\n            loading: loading\n          })]\n        })]\n      }), /*#__PURE__*/_jsx(FormPerson, {\n        close: getModal,\n        visible: modal\n      })]\n    })\n  });\n};\n\nexport default homeScreen;","map":null,"metadata":{},"sourceType":"module"}