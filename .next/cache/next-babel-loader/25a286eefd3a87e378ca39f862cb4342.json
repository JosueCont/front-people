{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Layout, Breadcrumb, Table, Row, Col, Input, Select, Switch, Button, Form, Avatar, message, Modal, Alert, Menu, Dropdown } from \"antd\";\nimport Axios from \"axios\";\nimport { API_URL } from \"../../config/config\";\nimport { useCallback, useEffect, useState, useRef } from \"react\";\nimport { SearchOutlined, PlusOutlined, DownloadOutlined, UploadOutlined, EllipsisOutlined } from \"@ant-design/icons\";\nimport MainLayout from \"../../layout/MainLayout\";\nimport _ from \"lodash\";\nimport FormPerson from \"../../components/person/FormPerson\";\nvar Content = Layout.Content;\nimport Link from \"next/link\";\n\nvar homeScreen = function homeScreen() {\n  var _useState = useState([]),\n      person = _useState[0],\n      setPerson = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(true),\n      status = _useState3[0],\n      setStatus = _useState3[1];\n\n  var _useState4 = useState(false),\n      modalAddPerson = _useState4[0],\n      setModalAddPerson = _useState4[1];\n\n  var _Form$useForm = Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      formFilter = _Form$useForm2[0];\n\n  var inputFileRef = useRef(null);\n  var filters = {};\n\n  var _useState5 = useState(\"https://khorplus.s3.amazonaws.com/demo/people/person/images/photo-profile/1412021224859/placeholder-profile-sq.jpg\"),\n      defaulPhoto = _useState5[0],\n      setDefaulPhoto = _useState5[1];\n\n  var _useState6 = useState(false),\n      modalDelete = _useState6[0],\n      setModalDelete = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      idsDelete = _useState7[0],\n      setIdsDelete = _useState7[1];\n\n  var _useState8 = useState([]),\n      personsToDelete = _useState8[0],\n      setPersonsToDelete = _useState8[1];\n\n  var _useState9 = useState(null),\n      stringToDelete = _useState9[0],\n      setStringToDelete = _useState9[1];\n\n  useEffect(function () {\n    getPerson();\n  }, []); /////PEOPLE\n\n  var getPerson = function getPerson(text) {\n    setLoading(true);\n\n    if (text == undefined) {\n      Axios.get(API_URL + \"/person/person/\").then(function (response) {\n        response.data.results.map(function (item, i) {\n          item.key = i;\n          if (!item.photo) item.photo = defaulPhoto;\n        });\n        setPerson(response.data.results);\n        setLoading(false);\n      })[\"catch\"](function (e) {\n        console.log(e);\n      });\n    } else {\n      Axios.post(API_URL + \"/person/person/get_list_persons/ \", filters).then(function (response) {\n        response.data.map(function (item) {\n          if (!item.photo) item.photo = defaulPhoto;\n        });\n        setPerson(response.data);\n        setLoading(false);\n      })[\"catch\"](function (e) {\n        setPerson([]);\n        setLoading(false);\n        console.log(e);\n      });\n    }\n  };\n\n  var deletePerson = function deletePerson() {\n    Axios.post(API_URL + \"/person/person/delete_by_ids/\", {\n      persons_id: idsDelete\n    }).then(function (response) {\n      showModalDelete();\n      getPerson();\n      setLoading(false);\n      message.success(\"Eliminado correctamente.\");\n    })[\"catch\"](function (error) {\n      setLoading(false);\n      console.log(error);\n    });\n  };\n\n  var statusPeron = function statusPeron() {\n    setStatus(status ? false : true);\n  };\n\n  var getModalPerson = function getModalPerson(value) {\n    setModalAddPerson(value);\n    setLoading(true);\n    Axios.get(API_URL + \"/person/person/\").then(function (response) {\n      response.data.results.map(function (item) {\n        item[\"key\"] = item.id;\n        item[\"fullname\"] = item.first_name + \" \" + item.flast_name + \" \" + item.mlast_name;\n        item.timestamp = item.timestamp.substring(0, 10);\n        if (!item.photo) item.photo = defaulPhoto;\n      });\n      setPerson(response.data.results);\n      setLoading(false);\n    })[\"catch\"](function (e) {\n      console.log(e);\n      setLoading(false);\n    });\n  }; ////SEARCH FILTER\n\n\n  var filter = function filter(value) {\n    if (value.name !== undefined && value.name !== \"\") {\n      filters.first_name = value.name;\n    }\n\n    if (value.gender !== undefined) {\n      filters.gender = value.gender;\n    }\n\n    if (status !== undefined) {\n      filters.is_active = status == false ? 0 : 1;\n    }\n\n    getPerson(\"filter\");\n  }; ////STYLE\n\n\n  var menuDropDownStyle = {\n    background: \"#434343\",\n    color: \"#ffff\"\n  }; /////TABLE PERSON\n\n  var columns = [{\n    title: \"Foto\",\n    render: function render(item) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        children: /*#__PURE__*/_jsx(Avatar, {\n          src: item.photo\n        })\n      });\n    }\n  }, {\n    title: \"Nombre\",\n    render: function render(item) {\n      var personName = item.first_name + \" \" + item.flast_name;\n      if (item.mlast_name) personName = personName + \" \" + item.mlast_name;\n      return /*#__PURE__*/_jsx(\"div\", {\n        children: personName\n      });\n    }\n  }, {\n    title: \"Estatus\",\n    render: function render(item) {\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: /*#__PURE__*/_jsx(Switch, {\n          defaultChecked: item.is_active,\n          checkedChildren: \"Activo\",\n          unCheckedChildren: \"Inactivo\",\n          onChange: function onChange() {\n            return onchangeStatus(item);\n          }\n        })\n      });\n    }\n  }, {\n    title: \"Fecha de ingreso\",\n    render: function render(item) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        children: item.date_of_admission\n      });\n    }\n  }, {\n    title: \"RFC\",\n    dataIndex: \"rfc\",\n    key: \"rfc\"\n  }, {\n    title: \"IMSS\",\n    dataIndex: \"imss\",\n    key: \"imss\"\n  }, {\n    title: function title() {\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: /*#__PURE__*/_jsx(Dropdown, {\n          overlay: menuGeneric,\n          children: /*#__PURE__*/_jsx(Button, {\n            style: menuDropDownStyle,\n            size: \"small\",\n            children: /*#__PURE__*/_jsx(EllipsisOutlined, {})\n          })\n        })\n      });\n    },\n    render: function render(item) {\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: /*#__PURE__*/_jsx(Dropdown, {\n          overlay: function overlay() {\n            return menuPerson(item);\n          },\n          children: /*#__PURE__*/_jsx(Button, {\n            style: {\n              background: \"#8c8c8c\",\n              color: \"withe\"\n            },\n            size: \"small\",\n            children: /*#__PURE__*/_jsx(EllipsisOutlined, {})\n          })\n        })\n      });\n    }\n  }];\n  var rowSelectionPerson = {\n    onChange: function onChange(selectedRowKeys, selectedRows) {\n      setPersonsToDelete(selectedRows);\n    }\n  };\n\n  var onchangeStatus = function onchangeStatus(value) {\n    value.is_active ? value.is_active = false : value.is_active = true;\n    delete value[\"photo\"];\n    Axios.put(API_URL + \"/person/person/\".concat(value.id, \"/\"), value).then(function (response) {\n      if (!response.data.photo) response.data.photo = defaulPhoto;\n      response.data.key = value.key;\n      person.map(function (a) {\n        if (a.id == response.data.id) a = response.data;\n      });\n    })[\"catch\"](function (error) {\n      console.log(error);\n    });\n  };\n\n  var menuGeneric = /*#__PURE__*/_jsx(Menu, {\n    children: /*#__PURE__*/_jsx(Menu.Item, {\n      onClick: function onClick() {\n        return setDeleteModal(personsToDelete);\n      },\n      children: \"Eliminar\"\n    })\n  });\n\n  var menuPerson = function menuPerson(item) {\n    return /*#__PURE__*/_jsxs(Menu, {\n      children: [/*#__PURE__*/_jsx(Menu.Item, {\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/home/\".concat(item.id),\n          children: \"Editar\"\n        })\n      }), /*#__PURE__*/_jsx(Menu.Item, {\n        onClick: function onClick() {\n          return setDeleteModal([item]);\n        },\n        children: \"Eliminar\"\n      })]\n    });\n  }; ////DEFAULT SELECT\n\n\n  var genders = [{\n    label: \"Masculino\",\n    value: 1\n  }, {\n    label: \"Femenino\",\n    value: 2\n  }, {\n    label: \"Otro\",\n    value: 3\n  }];\n  useEffect(function () {\n    console.log(personsToDelete);\n  }, [personsToDelete]); /////DELETE MODAL\n\n  var setDeleteModal = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value) {\n      var ids;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(value);\n              setStringToDelete('Eliminar usuarios ');\n\n              if (value.length > 0) {\n                if (value.length == 1) {\n                  setStringToDelete('Eliminar usuario ' + value[0].first_name + ' ' + value[0].flast_name);\n                }\n\n                setPersonsToDelete(value);\n                console.log(personsToDelete);\n                ids = null;\n                value.map(function (a) {\n                  if (ids) ids = ids + \",\" + a.id;else ids = a.id;\n                });\n                setIdsDelete(ids);\n                showModalDelete();\n              } else {\n                message.error(\"Selecciona una persona.\");\n              }\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function setDeleteModal(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var ListElementsToDelete = function ListElementsToDelete(_ref2) {\n    var personsDelete = _ref2.personsDelete;\n    return /*#__PURE__*/_jsx(\"div\", {\n      children: personsDelete.map(function (p) {\n        return /*#__PURE__*/_jsx(_Fragment, {\n          children: /*#__PURE__*/_jsxs(Row, {\n            children: [/*#__PURE__*/_jsx(Avatar, {\n              src: p.photo\n            }), /*#__PURE__*/_jsx(\"span\", {\n              children: \" \" + p.first_name + \" \" + p.flast_name\n            })]\n          })\n        });\n      })\n    });\n  };\n\n  var showModalDelete = function showModalDelete() {\n    modalDelete ? setModalDelete(false) : setModalDelete(true);\n  }; ////IMPORT/EXPORT PERSON\n\n\n  var downloadPersons = function downloadPersons() {\n    setLoading(true);\n    Axios.get(API_URL + \"/person/import-export-person/csv\").then(function (response) {\n      var type = response.headers[\"content-type\"];\n      var blob = new Blob([response.data], {\n        type: type,\n        encoding: \"UTF-8\"\n      });\n      var link = document.createElement(\"a\");\n      link.href = window.URL.createObjectURL(blob);\n      link.download = \"Personas.csv\";\n      link.click();\n      setLoading(false);\n    })[\"catch\"](function (e) {\n      setLoading(false);\n      console.log(e);\n    });\n  };\n\n  var downloadPlantilla = function downloadPlantilla() {\n    setLoading(true);\n    Axios.get(API_URL + \"/person/import-export-person/plantilla\").then(function (response) {\n      var type = response.headers[\"content-type\"];\n      var blob = new Blob([response.data], {\n        type: type,\n        encoding: \"UTF-8\"\n      });\n      var link = document.createElement(\"a\");\n      link.href = window.URL.createObjectURL(blob);\n      link.download = \"PlantillaPersonas.csv\";\n      link.click();\n      setLoading(false);\n    })[\"catch\"](function (e) {\n      setLoading(false);\n      console.log(e);\n    });\n  };\n\n  var importFile = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      var extension, formData;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              extension = getFileExtension(e.target.files[0].name);\n\n              if (extension == \"csv\") {\n                formData = new FormData();\n                formData.append(\"File\", e.target.files[0]);\n                setLoading(true);\n                Axios.post(API_URL + \"/person/import-export-person\", formData).then(function (response) {\n                  setLoading(false);\n                  message.success(\"Excel importado correctamente.\");\n                  getPerson();\n                })[\"catch\"](function (e) {\n                  setLoading(false);\n                  message.error(\"Error al importar.\");\n                  console.log(e);\n                });\n              } else {\n                message.error(\"Formato incorrecto, suba un archivo .csv\");\n              }\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function importFile(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var getFileExtension = function getFileExtension(filename) {\n    return /[.]/.exec(filename) ? /[^.]+$/.exec(filename)[0] : undefined;\n  };\n\n  return /*#__PURE__*/_jsxs(MainLayout, {\n    currentKey: \"1\",\n    children: [/*#__PURE__*/_jsxs(Breadcrumb, {\n      children: [/*#__PURE__*/_jsx(Breadcrumb.Item, {\n        children: \"Inicio\"\n      }), /*#__PURE__*/_jsx(Breadcrumb.Item, {\n        children: \"Personas\"\n      })]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"container\",\n      style: {\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxs(Row, {\n        justify: 'space-between',\n        className: 'formFilter',\n        children: [/*#__PURE__*/_jsx(Col, {\n          xs: 24,\n          sm: 24,\n          md: 20,\n          lg: 20,\n          xl: 20,\n          children: /*#__PURE__*/_jsx(Form, {\n            onFinish: filter,\n            layout: \"vertical\",\n            form: formFilter,\n            children: /*#__PURE__*/_jsxs(Row, {\n              children: [/*#__PURE__*/_jsx(Col, {\n                lg: 7,\n                xs: 22,\n                offset: 1,\n                children: /*#__PURE__*/_jsx(Form.Item, {\n                  name: \"name\",\n                  children: /*#__PURE__*/_jsx(Input, {\n                    placeholder: \"Nombre\"\n                  })\n                })\n              }), /*#__PURE__*/_jsx(Col, {\n                lg: 4,\n                xs: 22,\n                offset: 1,\n                children: /*#__PURE__*/_jsx(Form.Item, {\n                  name: \"gender\",\n                  children: /*#__PURE__*/_jsx(Select, {\n                    options: genders,\n                    placeholder: \"G\\xE9nero\"\n                  })\n                })\n              }), /*#__PURE__*/_jsx(Col, {\n                lg: 3,\n                xs: 5,\n                offset: 1,\n                children: /*#__PURE__*/_jsxs(Form.Item, {\n                  name: \"is_active\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: /*#__PURE__*/_jsx(\"span\", {\n                      style: {\n                        fontWeight: \"bold\"\n                      },\n                      children: \"Activos:\"\n                    })\n                  }), /*#__PURE__*/_jsx(Switch, {\n                    style: {\n                      marginLeft: \"10%\"\n                    },\n                    defaultChecked: true,\n                    onChange: statusPeron\n                  })]\n                })\n              }), /*#__PURE__*/_jsx(Col, {\n                lg: 2,\n                xs: 5,\n                offset: 1,\n                children: /*#__PURE__*/_jsx(Form.Item, {\n                  children: /*#__PURE__*/_jsx(Button, {\n                    icon: /*#__PURE__*/_jsx(SearchOutlined, {}),\n                    type: \"primary\",\n                    htmlType: \"submit\",\n                    children: \"Buscar\"\n                  })\n                })\n              })]\n            })\n          })\n        }), /*#__PURE__*/_jsx(Col, {\n          children: /*#__PURE__*/_jsxs(Button, {\n            style: {\n              background: \"#fa8c16\",\n              fontWeight: \"bold\",\n              color: \"white\"\n            },\n            onClick: function onClick() {\n              return getModalPerson(true);\n            },\n            children: [/*#__PURE__*/_jsx(PlusOutlined, {}), \"Agregar persona\"]\n          })\n        })]\n      }), /*#__PURE__*/_jsx(Row, {\n        justify: 'end',\n        children: /*#__PURE__*/_jsxs(Col, {\n          children: [/*#__PURE__*/_jsx(Button, {\n            className: 'ml-20',\n            type: \"primary\",\n            icon: /*#__PURE__*/_jsx(DownloadOutlined, {}),\n            size: {\n              size: \"large\"\n            },\n            onClick: function onClick() {\n              return downloadPersons();\n            },\n            children: \"Descargar resultados\"\n          }), /*#__PURE__*/_jsx(Button, {\n            className: 'ml-20',\n            icon: /*#__PURE__*/_jsx(UploadOutlined, {}),\n            onClick: function onClick() {\n              inputFileRef.current.click();\n            },\n            children: \"Importar personas\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            ref: inputFileRef,\n            type: \"file\",\n            style: {\n              display: \"none\"\n            },\n            onChange: function onChange(e) {\n              return importFile(e);\n            }\n          }), /*#__PURE__*/_jsx(Button, {\n            className: 'ml-20',\n            type: \"primary\",\n            icon: /*#__PURE__*/_jsx(DownloadOutlined, {}),\n            size: {\n              size: \"large\"\n            },\n            onClick: function onClick() {\n              return downloadPlantilla();\n            },\n            children: \"Descargar plantilla\"\n          })]\n        })\n      }), /*#__PURE__*/_jsx(Table, {\n        className: 'mainTable',\n        size: \"small\",\n        columns: columns,\n        dataSource: person,\n        loading: loading,\n        rowSelection: rowSelectionPerson\n      })]\n    }), /*#__PURE__*/_jsx(FormPerson, {\n      close: getModalPerson,\n      visible: modalAddPerson\n    }), /*#__PURE__*/_jsx(Modal, {\n      title: stringToDelete,\n      visible: modalDelete,\n      onOk: deletePerson,\n      onCancel: showModalDelete,\n      okText: \"Si, Eliminar\",\n      cancelText: \"Cancelar\",\n      children: /*#__PURE__*/_jsx(\"p\", {\n        style: {\n          padding: '30px 60px'\n        },\n        children: \"Al eliminar este registro perder\\xE1 todos los datos relacionados a el de manera permanente. \\xBFEst\\xE1 seguro de querer eliminarlo?\"\n      })\n    })]\n  });\n};\n\nexport default homeScreen;","map":null,"metadata":{},"sourceType":"module"}